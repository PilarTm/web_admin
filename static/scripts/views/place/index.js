var mark_converters=new MARK_CONVERTER_COLLECTIONS,model_converters=new MODEL_CONVERTER_COLLECTIONS,mark_e_counters=new MARK_E_COUNTERS_COLLECTIONS,model_e_counters=new MODEL_E_COUNTERS_COLLECTIONS;mark_converters.fetch(),model_converters.fetch(),mark_e_counters.fetch(),model_e_counters.fetch(),$(document).ready(function(){$("#jstree_demo_div").jstree({core:{data:{url:function(e){return e.id=="#"?"/api/place_jstree/":"/api/place_jstree/"+function(e){console.log(e.id);if(e.id.match(/place_([0-9]*)_places$/)){var t=e.id.match(/place_([0-9]*)_places/);return t[1]+"/children_place"}if(e.id.match(/place_([0-9]*)$/)){var t=e.id.match(/place_([0-9]*)/);return t[1]}if(e.id.match(/place_([0-9]*)_users/)){var t=e.id.match(/place_([0-9]*)_users/);return t[1]+"/users"}if(e.id.match(/place_([0-9]*)_converters/)){var t=e.id.match(/place_([0-9]*)_converters/);return t[1]+"/converters"}if(e.id.match(/place_([0-9]*)_e_counters/)){var t=e.id.match(/place_([0-9]*)_e_counters/);return t[1]+"/e_counters"}if(e.id.match(/place_([0-9]*)_admins/)){var t=e.id.match(/place_([0-9]*)_admins/);return t[1]+"/admins"}if(e.id.match(/place_([0-9]*)_reports/)){var t=e.id.match(/place_([0-9]*)_reports/);return t[1]+"/reports"}return 0}(e)}},themes:{name:"proton",responsive:!0}},plugins:["contextmenu"],contextmenu:{items:function(e){console.log(e.id);if(e.id.match(/place_([0-9]*)$/)){var t=e.id.match(/place_([0-9]*)/);return{Rename:{separator_before:!1,separator_after:!1,label:"Переименовать",action:function(e,n){var r=new PLACE_MODEL({id:Number(t[1])});r.fetch({success:function(){new PLACE_MODEL_EDIT(r,function(){$("#jstree_demo_div").jstree(!0).set_text("place_"+t[1],r.get("title"))})}})}},Move:{separator_before:!0,separator_after:!1,label:"Перенести",action:function(e){var n=new PLACE_MODEL({id:Number(t[1])});n.fetch({success:function(){new PLACE_MODEL_MOVE(n,function(){$("#place_"+Number(t[1])).remove(),$("#jstree_demo_div").jstree(!1).load_node("place_"+n.get("place_id"))})}})}},Remove:{separator_before:!0,separator_after:!1,label:"Удалить",action:function(e){var n=new PLACE_MODEL({id:Number(t[1])});new PLACE_MODEL_DELETE(n,function(){$("#place_"+Number(t[1])).remove()})}}}}return e.id.match(/ecounters_([0-9]*)$/)?{Rename:{separator_before:!1,separator_after:!1,label:"Отвязать",action:function(t){tree.edit(e)}}}:e.id.match(/converter_([0-9]*)$/)?{Rename:{separator_before:!1,separator_after:!1,label:"Отвязать",action:function(t){tree.edit(e)}}}:{}}}})}),$("#jstree_demo_div").bind("changed.jstree",function(e,t){if(t.node.id.match(/place_([0-9]*)_places_add/)){var n=t.node.id.replace(/place_([0-9]*)_places_add/,function(e,t){return t}),r=new PLACE_MODEL({place_id:Number(n)});new PLACE_MODEL_EDIT(r,function(){$("#jstree_demo_div").jstree(!1).load_node("place_"+n+"_places")})}else if(t.node.id.match(/place_([0-9]*)_users_register/)){var n=t.node.id.replace(/place_([0-9]*)_users_register/,function(e,t){return t}),i=new USER_MODEL({place_id:Number(n),is_registration:!0});new USER_MODAL_REGISTARATION(i,function(){$("#jstree_demo_div").jstree(!1).load_node("place_"+n+"_users")})}else if(t.node.id.match(/place_([0-9]*)_admins_register/)){var n=t.node.id.replace(/place_([0-9]*)_admins_register/,function(e,t){return t}),i=new USER_MODEL({place_id:Number(n),is_registration:!0,type:1});new USER_MODAL_REGISTARATION(i,function(){$("#jstree_demo_div").jstree(!1).load_node("place_"+n+"_admins")})}else if(t.node.id.match(/place_([0-9]*)_converters_add/)){var n=t.node.id.replace(/place_([0-9]*)_converters_add/,function(e,t){return t}),s=new CONVERTER_MODEL({place_id:Number(n)});new CONVERTER_MODAL_EDIT(s,new CONVERTER_COLLECTIONS,mark_converters,model_converters,function(){$("#jstree_demo_div").jstree(!1).load_node("place_"+n+"_converters")})}else if(t.node.id.match(/place_([0-9]*)_e_counters_add/)){var n=t.node.id.replace(/place_([0-9]*)_e_counters_add/,function(e,t){return t}),o=new E_COUNTERS_MODEL({place_id:Number(n)});new E_COUNTERS_MODAL_EDIT(o,new E_COUNTERS_COLLECTIONS,mark_e_counters,model_e_counters,function(){$("#jstree_demo_div").jstree(!1).load_node("place_"+n+"_e_counters")},concentrators)}else t.node.id.match(/place_([0-9]*)_reports_(.*)/)&&(window.location.pathname=t.node.id.replace(/place_([0-9]*)_reports_(.*)/,function(e,t,n){return"/admin/places/"+t+"/reports/"+n}))});