// Generated by CoffeeScript 1.4.0
var auth_footer, auth_view, user_model;

user_model = Backbone.Model.extend({
  defaults: {
    id: 0,
    login: "",
    pass: ""
  },
  is_valid_auth: function() {
    if (!this.validate_email()) {
      return false;
    }
    if (this.get("pass") === "") {
      return false;
    }
    return true;
  },
  validate_email: function() {
    var re;
    re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(String(this.get("login")).toLowerCase());
  }
});

auth_footer = Backbone.View.extend({
  el: "#auth_form_footer",
  template: "#loginForm_footer_tpl",
  model: new user_model,
  initialize: function(model) {
    this.model = model;
    this.listenTo(this.model, "change", this.render);
    return this.render();
  },
  render: function() {
    var tpl;
    tpl = _.template($(this.template).html());
    return $(this.$el).empty().append(tpl({
      user: this.model
    }));
  }
});

auth_view = Backbone.View.extend({
  el: "#loginForm",
  template: "#loginForm_tpl",
  model: new user_model,
  initialize: function() {
    return this.render();
  },
  render: function() {
    var tpl;
    tpl = _.template($(this.template).html());
    $(this.$el).empty().append(tpl({
      user: this.model
    }));
    return new auth_footer(this.model);
  },
  _setter_login: function(e) {
    return this.model.set("login", $(e.target).val());
  },
  events: {
    "paste #username": function(e) {
      return this._setter_login(e);
    },
    "blur #username": function(e) {
      return this._setter_login(e);
    },
    "change #username": function(e) {
      return this._setter_login(e);
    },
    "keyup #username": function(e) {
      return this._setter_login(e);
    },
    "keyup #password": function(e) {
      return this.model.set("pass", $(e.target).val());
    }
  }
});

$(document).ready(function() {
  return new auth_view;
});
